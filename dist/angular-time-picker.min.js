"use strict";angular.module("ngTimePicker",[]).directive("ngTimePicker",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"../../src/angular-time-picker.tpl.html",scope:{timeSettings:"=",dropdownToggleState:"=?",format:"=?",theme:"=?",noRange:"=",noValidation:"=",applyCallback:"&",clearCallback:"&"},link:function(b,c){var d,e=[],f=[];for(b.startingTimeHoursRange=[],b.endingTimeHoursRange=[],b.startingTimeHMinutesRange=[],b.endingTimeHMinutesRange=[],b.timeSettings=b.timeSettings||{},b.theme=b.theme?"angular-time-picker-"+b.theme:"angular-time-picker-light",b.timeHourFormat=b.format&&12===parseInt(b.format,10)?12:24,d=0;d<b.timeHourFormat;d++)e.push({name:10>d?"0"+d:d+"",value:10>d?"0"+d:d+""});for(d=0;60>d;d++)f.push({name:10>d?"0"+d:d+"",value:10>d?"0"+d:d+""});angular.copy(e,b.startingTimeHoursRange),angular.copy(f,b.startingTimeHMinutesRange),angular.copy(e,b.endingTimeHoursRange),angular.copy(f,b.endingTimeHMinutesRange),!b.noValidation&&b.timeSettings.toHour<b.timeSettings.fromHour&&(b.timeSettings.toHour=b.timeSettings.fromHour),b.updateTimeRangeFilter=function(){b.timeSettings.fromHour=b.startingHour,b.timeSettings.fromMinute=b.startingMinute,b.noRange||(b.timeSettings.toHour=b.endingHour,b.timeSettings.toMinute=b.endingMinute)},b.setInitialTimeRange=function(){angular.isUndefined(b.timeSettings.fromHour)&&(b.timeSettings.fromHour=b.startingTimeHoursRange[0].value),b.initStartingHour=b.startingHour=b.timeSettings.fromHour,angular.isUndefined(b.timeSettings.fromMinute)&&(b.timeSettings.fromMinute=b.endingTimeHMinutesRange[0].value),b.initStartingMinute=b.startingMinute=b.timeSettings.fromMinute,!b.noRange&&angular.isUndefined(b.timeSettings.toHour)&&(b.timeSettings.toHour=b.startingTimeHoursRange[b.timeHourFormat-1].value),b.initEndingHourHour=b.endingHour=b.timeSettings.toHour,!b.noRange&&angular.isUndefined(b.timeSettings.toMinute)&&(b.timeSettings.toMinute=b.endingTimeHMinutesRange[59].value),b.initEndingMinute=b.endingMinute=b.timeSettings.toMinute},b.resetToOriginalTimeSettings=function(){b.startingHour=b.initStartingHour,b.startingMinute=b.initStartingMinute,b.noRange||(b.endingHour=b.initEndingHourHour,b.endingMinute=b.initEndingMinute),b.applyTimeRangeFilter()},b.clearTimeRange=function(){b.clearCallback(),b.closeTimeFilterDropdown()},b.applyTimeRangeFilter=function(){b.updateTimeRangeFilter(),b.applyCallback(),b.closeTimeFilterDropdown()},b.closeTimeFilterDropdown=function(){b.dropdownToggleState=!1,b.startingHour=b.timeSettings.fromHour,b.startingMinute=b.timeSettings.fromMinute,b.noRange||(b.endingHour=b.timeSettings.toHour,b.endingMinute=b.timeSettings.toMinute)},b.validateHours=function(){if(b.startingHour!==b.endingHour)for(var a=0;a<f.length;a++)b.startingTimeHMinutesRange[a].disabled=!1,b.endingTimeHMinutesRange[a].disabled=!1;else b.startingMinute>=b.endingMinute?"00"!==b.endingMinute?(b.startingMinute=b.endingMinute-1,b.startingMinute=b.startingMinute<10?"0"+b.startingMinute:b.startingMinute+"",b.validateStartingMinuteTime()):"00"===b.endingMinute&&(b.endingMinute="01"):b.startingHour===b.endingHour&&(b.validateStartingMinuteTime(),b.validateEndingMinuteTime());b.areInitialSettingsValidated||b.applyTimeRangeFilter()},b.validateStartingMinuteTime=function(){for(var a=0;a<f.length;a++)a>parseInt(b.endingMinute,10)-1&&a<f.length?b.startingTimeHMinutesRange[a].disabled=!0:b.startingTimeHMinutesRange[a].disabled=!1},b.validateEndingMinuteTime=function(){for(var a=0;a<f.length;a++)a>=0&&a<parseInt(b.startingMinute,10)+1?b.endingTimeHMinutesRange[a].disabled=!0:b.endingTimeHMinutesRange[a].disabled=!1},b.noRange||b.noValidation||(b.$watch("startingHour",function(a,c){if(a&&a!==c){for(var d=0;d<e.length;d++)d>=0&&d<parseInt(b.startingHour,10)?b.endingTimeHoursRange[d].disabled=!0:b.endingTimeHoursRange[d].disabled=!1;b.validateHours(b.startingHour,b.endingTimeHoursRange)}}),b.$watch("startingMinute",function(a,c){a&&a!==c&&b.startingHour===b.endingHour&&b.validateEndingMinuteTime()}),b.$watch("endingHour",function(a,c){if(a&&a!==c){for(var d=0;d<e.length;d++)d>parseInt(b.endingHour,10)&&d<e.length?b.startingTimeHoursRange[d].disabled=!0:b.startingTimeHoursRange[d].disabled=!1;b.validateHours(b.endingHour,b.startingTimeHoursRange)}}),b.$watch("endingMinute",function(a,c){a&&a!==c&&b.startingHour===b.endingHour&&(b.validateStartingMinuteTime(),b.areInitialSettingsValidated||(b.areInitialSettingsValidated=!0))})),a(function(){b.setInitialTimeRange()},0),c.bind("click",function(a){null!==a&&"function"==typeof a.stopPropagation&&a.stopPropagation()});var g=function(){b.closeTimeFilterDropdown(),b.$digest()};angular.element(document).bind("click",g),b.$on("$destroy",function(){return angular.element(document).unbind("click",g)})}}}]);